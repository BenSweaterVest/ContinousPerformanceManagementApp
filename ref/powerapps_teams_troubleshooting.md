# Building Power Apps for Teams with Dataverse: A Technical Specification Guide (for Coding Agents)

This guide provides a **general, implementation-focused specification** for coding agents (e.g., Claude, ChatGPT, GitHub Copilot) generating Power Apps solutions intended to run inside **Microsoft Teams** using **Dataverse for Teams**. It includes platform constraints, supported components, import/export details, automation patterns, and an example case (Continuous Performance Management App) for reference.

---

## 1. Understanding Dataverse for Teams (DV4T)

Dataverse for Teams is a *lightweight* Power Platform environment automatically created for each Team. It has a more constrained feature set than full Dataverse.

### 1.1 Supported Components
| Component | Supported? | Notes |
|----------|------------|-------|
| **Canvas Apps** | ✔️ | Built and run inside Teams; cannot be exported in a solution. |
| **Custom Tables** | ✔️ | Only *custom* tables; standard tables (Account, Contact, etc.) are not allowed. |
| **Power Automate Flows** | ✔️ | Cloud flows only; no business process flows. Must use connection references. |
| **Solution Packages** | Partially | Solutions can include tables, flows, environment variables, connection refs—but *not canvas apps*. |
| **Plugins / Custom Code** | ❌ | No C# plugins, no workflows, no custom server logic. |
| **PCF Components** | ❌ | Power Apps component framework is not available in DV4T. |
| **API Access** | ❌ | Dataverse Web API is blocked; only Power Fx and flows can read/write. |
| **Power Pages / Model-Driven Apps** | ❌ | Not available in Teams environments. |

### 1.2 Environment Constraints
| Limit | Value |
|-------|--------|
| Storage | ~2GB shared per Team |
| Table Rows | ~1M total (practical constraints lower) |
| App Load Timeout | 30 seconds |
| Max Tables Per Environment | Unofficial ~300 (practical) |
| Max Teams Environment Per Tenant | 500 |

---

## 2. Building a Teams-Compatible Power App

Below is the specification an AI coding agent should follow.

### 2.1 Architecture Pattern (Microsoft-Recommended)
Every Teams Dataverse app follows this structure:

```
Solution (ZIP)
├── Custom Dataverse tables
├── Power Automate flows
├── Environment variables (optional)
├── Connection references
└── *Canvas app (NOT included in solution)*
```

### 2.2 Canvas App Requirements
Because DV4T does **not** allow canvas apps to be exported in solutions, coding agents must:

1. Generate the **Power Fx formulas**, screen layout specs, and component tree.
2. Produce them in a reusable markdown/UI spec format.
3. A human developer recreates it manually in Power Apps for Teams.

A typical spec generated by an agent should include:
- Screen list and hierarchy
- Controls per screen
- Naming before coding (e.g., `btnSubmit`, `galRecords`)
- Power Fx formulas for each property

Example:
```
Screen: HomeScreen
 Controls:
   galEvaluations:
     Items: Filter('Evaluation Table', User() = ThisUser)
   btnNewEval:
     OnSelect: Navigate(NewEvaluationScreen)
```

---

## 3. Automation & Workflow: Power Automate in Teams

### 3.1 Supported Flow Types
- Cloud flows triggered by:
  - Button
  - Dataverse (row added/modified)
  - Recurrence
  - Teams actions (message posted, adaptive card response)

### 3.2 Unsupported
- Desktop flows
- Business process flows (BPF)
- Premium connectors unless tenant has licenses

### 3.3 Connection References (Required)
When generating solution-aware flows, the AI must:
- Create connection reference components
- Bind flows to those references

Example YAML snippet (unpacked solution):
```yaml
ConnectionReferences:
  shared_commondataserviceforapps: 
    connectionName: cdsref
    connectorId: /providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps
```

---

## 4. Solution Packaging (for Import into Teams)

### 4.1 Required Components in the Solution
A DV4T-compatible solution **must only contain**:
- Custom tables
- Flows
- Environment variables (optional)
- Connection references

### 4.2 Forbidden Components
- Canvas apps
- PCF controls
- Standard Dataverse tables
- Plugins

### 4.3 Export/Import Rules
- Solutions must be exported from a **full Dataverse environment**, not from Teams.
- Then imported **into** a Teams Dataverse environment.
- Canvas apps must be reconstructed manually.

### 4.4 Import Steps (General)
1. Open **Power Apps in Teams**.
2. Select **Build** > choose Team.
3. Click **Import Solution**.
4. Upload ZIP.
5. Map connection references.
6. Fix environment variables.
7. Import tables & flows.
8. Manually rebuild canvas app.

---

## 5. Data & Seeding Limitations

### 5.1 No static data can be included in a solution
Agents must generate **post-import scripts or instructions** for:
- Seeding lookup tables
- Creating default rows

Options:
- Manual entry
- Power Automate bootstrap flow
- Custom script using Power Platform CLI (requires full Dataverse—not DV4T)


---

## 6. Recommended Output Structure for AI Coding Agents
When asking an AI to generate a Teams Dataverse app, the expected output format should include:

```
/app-spec
  canvas-app-spec.md
  flows-spec.md
  tables-spec.yaml
  environment-variables.json
  solution-architecture.md
/example-scripts
  pack-solution.ps1
  unpack-solution.yml
  post-import-seeding-instructions.md
```

---

## 7. Example: Continuous Performance Management App
(This section preserved from your earlier request.)

Used as a reference implementation showing:
- Tables required (Evaluation, Evaluation Questions, Employee Profile)
- Required seeding steps
- Flow reconnection requirements
- Canvas app rebuild steps

This example illustrates **common DV4T pitfalls**, including:
- Inability to include app in solution
- Static data restrictions
- Flow connection reference failures after import
- Environment variable remapping on import

---

## 8. Quick Checklist for Agents

### Always:
- Use only *custom* tables.
- Define full table schema in YAML or JSON.
- Generate all Power Fx formulas explicitly.
- Produce a reconstruction spec for the canvas app.
- Include connection references.
- Document all required post-import steps.

### Never:
- Use standard Dataverse tables.
- Use APIs, plugins, or PCF controls.
- Attempt to package a canvas app in the solution.

---

## 9. Authoritative Microsoft Documentation
- Dataverse for Teams overview
- Build apps in Teams
- Importing solutions in Teams
- Power Automate with Teams
- Power Platform CLI

(Links intentionally omitted inside this environment—can be added externally.)

---

If you want, I can also generate:
- A **scaffolded folder structure** ready for an AI agent
- A **Teams-ready template solution**
- A **prompt template** optimized for Claude or OpenAI to generate full DV4T apps

