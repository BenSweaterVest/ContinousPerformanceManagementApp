# Building Power Apps for Teams with Dataverse: A Technical Specification Guide (for Coding Agents)

This guide provides a **general, implementation-focused specification** for coding agents (e.g., Claude, ChatGPT, GitHub Copilot) generating Power Apps solutions intended to run inside **Microsoft Teams** using **Dataverse for Teams**. It includes platform constraints, supported components, import/export details, automation patterns, and an example case (Continuous Performance Management App) for reference.

---

## 1. Understanding Dataverse for Teams (DV4T)

Dataverse for Teams is a *lightweight* Power Platform environment automatically created for each Team. It has a more constrained feature set than full Dataverse.

### 1.1 Supported Components
| Component | Supported? | Notes |
|----------|------------|-------|
| **Canvas Apps** | ✔️ | Built and run inside Teams; cannot be exported in a solution. |
| **Custom Tables** | ✔️ | Only *custom* tables; standard tables (Account, Contact, etc.) are not allowed. |
| **Power Automate Flows** | ✔️ | Cloud flows only; no business process flows. Must use connection references. |
| **Solution Packages** | Partially | Solutions can include tables, flows, environment variables, connection refs—but *not canvas apps*. |
| **Plugins / Custom Code** | ❌ | No C# plugins, no workflows, no custom server logic. |
| **PCF Components** | ❌ | Power Apps component framework is not available in DV4T. |
| **API Access** | ❌ | Dataverse Web API is blocked; only Power Fx and flows can read/write. |
| **Power Pages / Model-Driven Apps** | ❌ | Not available in Teams environments. |

### 1.2 Environment Constraints
| Limit | Value |
|-------|--------|
| Storage | ~2GB shared per Team |
| Table Rows | ~1M total (practical constraints lower) |
| App Load Timeout | 30 seconds |
| Max Tables Per Environment | Unofficial ~300 (practical) |
| Max Teams Environment Per Tenant | 500 |

---

## 2. Building a Teams-Compatible Power App

Below is the specification an AI coding agent should follow.

### 2.1 Architecture Pattern (Microsoft-Recommended)
Every Teams Dataverse app follows this structure:

```
Solution (ZIP)
├── Custom Dataverse tables
├── Power Automate flows
├── Environment variables (optional)
├── Connection references
└── *Canvas app (NOT included in solution)*
```

### 2.2 Canvas App Requirements
Because DV4T does **not** allow canvas apps to be exported in solutions, coding agents must:

1. Generate the **Power Fx formulas**, screen layout specs, and component tree.
2. Produce them in a reusable markdown/UI spec format.
3. A human developer recreates it manually in Power Apps for Teams.

A typical spec generated by an agent should include:
- Screen list and hierarchy
- Controls per screen
- Naming before coding (e.g., `btnSubmit`, `galRecords`)
- Power Fx formulas for each property

Example:
```
Screen: HomeScreen
 Controls:
   galEvaluations:
     Items: Filter('Evaluation Table', User() = ThisUser)
   btnNewEval:
     OnSelect: Navigate(NewEvaluationScreen)
```

---

## 3. Automation & Workflow: Power Automate in Teams

### 3.1 Supported Flow Types
- Cloud flows triggered by:
  - Button
  - Dataverse (row added/modified)
  - Recurrence
  - Teams actions (message posted, adaptive card response)

### 3.2 Unsupported
- Desktop flows
- Business process flows (BPF)
- Premium connectors unless tenant has licenses

### 3.3 Connection References (Required)
When generating solution-aware flows, the AI must:
- Create connection reference components
- Bind flows to those references

Example YAML snippet (unpacked solution):
```yaml
ConnectionReferences:
  shared_commondataserviceforapps: 
    connectionName: cdsref
    connectorId: /providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps
```

---

## 4. Solution Packaging (for Import into Teams)

### 4.1 Required Components in the Solution
A DV4T-compatible solution **must only contain**:
- Custom tables
- Flows
- Environment variables (optional)
- Connection references

### 4.2 Forbidden Components
- Canvas apps
- PCF controls
- Standard Dataverse tables
- Plugins

### 4.3 Export/Import Rules
- Solutions must be exported from a **full Dataverse environment**, not from Teams.
- Then imported **into** a Teams Dataverse environment.
- Canvas apps must be reconstructed manually.

### 4.4 Import Steps (General)
1. Open **Power Apps in Teams**.
2. Select **Build** > choose Team.
3. Click **Import Solution**.
4. Upload ZIP.
5. Map connection references.
6. Fix environment variables.
7. Import tables & flows.
8. Manually rebuild canvas app.

---

## 5. Data & Seeding Limitations

### 5.1 No static data can be included in a solution
Agents must generate **post-import scripts or instructions** for:
- Seeding lookup tables
- Creating default rows

Options:
- Manual entry
- Power Automate bootstrap flow
- Custom script using Power Platform CLI (requires full Dataverse—not DV4T)


---

## 6. Recommended Output Structure for AI Coding Agents
When asking an AI to generate a Teams Dataverse app, the expected output format should include:

```
/app-spec
  canvas-app-spec.md
  flows-spec.md
  tables-spec.yaml
  environment-variables.json
  solution-architecture.md
/example-scripts
  pack-solution.ps1
  unpack-solution.yml
  post-import-seeding-instructions.md
```

---

## 7. Example: Continuous Performance Management App
(This section preserved from your earlier request.)

Used as a reference implementation showing:
- Tables required (Evaluation, Evaluation Questions, Employee Profile)
- Required seeding steps
- Flow reconnection requirements
- Canvas app rebuild steps

This example illustrates **common DV4T pitfalls**, including:
- Inability to include app in solution
- Static data restrictions
- Flow connection reference failures after import
- Environment variable remapping on import

---

## 8. Quick Checklist for Agents

### Always:
- Use only *custom* tables.
- Define full table schema in YAML or JSON.
- Generate all Power Fx formulas explicitly.
- Produce a reconstruction spec for the canvas app.
- Include connection references.
- Document all required post-import steps.

### Never:
- Use standard Dataverse tables.
- Use APIs, plugins, or PCF controls.
- Attempt to package a canvas app in the solution.

---

## 9. Authoritative Microsoft Documentation
- Dataverse for Teams overview
- Build apps in Teams
- Importing solutions in Teams
- Power Automate with Teams
- Power Platform CLI

(Links intentionally omitted inside this environment—can be added externally.)

---

## 10. Prompt Template (for Claude / coding agents)

Use this prompt when asking an LLM to generate a Teams Dataverse solution. It makes explicit what files and artifacts the agent should output.

```
SYSTEM: You are an expert Power Platform developer generating artifacts for Dataverse-for-Teams (DV4T). Produce only files and code; do not attempt to package canvas apps. Follow the "DV4T constraints" exactly.

USER: Build a Teams Dataverse solution for the following feature set: <brief description>. Output a folder structure and the following files:
- tables-spec.yaml: full table schemas (logical & display names, columns, types, required flags, lookup relationships)
- flows-spec.md: textual descriptions of each flow, triggers, actions, and connection references
- canvas-app-spec.md: full screen list, control tree, Power Fx formulas for key properties, and step-by-step rebuild instructions for Power Apps Studio
- environment-variables.json: list and default values
- connectionreferences.json: connector IDs and logical names
- post-import-seeding-instructions.md: exact Power Automate or manual steps to seed tables
- pack-solution.ps1 and import-solution.ps1: Power Platform CLI commands to pack/import a solution

Output rules:
1. Use YAML for table schemas.
2. Use Power Fx expressions exactly as they should appear in Studio.
3. Include example connection reference stubs for Dataverse and Office 365 Outlook.
4. Include a short test-plan checklist (import, reconnect flows, seed data, test flows, test UI).
5. If the feature requires anything unsupported in DV4T, provide an explicit migration plan to full Dataverse.

END
```

---

## 11. Starter Solution Scaffold (files and example snippets)

Below is a recommended folder layout and small example content that the coding agent should produce. Files shown are *examples* — the agent should generate full versions based on the requested app.

```
starter-solution/
  solution-unpacked/
    solution.xml
    customizations/
      tables-spec.yaml
      connectionreferences.json
      environment-variables.json
    flows/
      ReminderFlow.spec.md
      SeedDataFlow.spec.md
    canvas-spec/
      canvas-app-spec.md
  scripts/
    pack-solution.ps1
    import-solution.ps1
    post-import-seed.ps1
  post-import-instructions.md
```

### example: `tables-spec.yaml` (partial)

```yaml
Tables:
  - logicalName: new_evaluation
    displayName: Evaluation
    primaryName: new_evaluationid
    columns:
      - name: new_title
        displayName: Title
        type: String
        required: true
      - name: new_employee
        displayName: Employee
        type: Lookup
        required: true
        target: new_employeeprofile
      - name: new_status
        displayName: Status
        type: Choice
        choices: [Draft, Submitted, Reviewed, Closed]
      - name: new_evaluationdate
        displayName: Evaluation Date
        type: DateTime
        required: true
```

### example: `connectionreferences.json` (partial)

```json
{
  "connectionReferences": {
    "shared_commondataserviceforapps": {
      "connectionName": "cdsref",
      "connectorId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
      "displayName": "Dataverse"
    },
    "shared_office365": {
      "connectionName": "office365ref",
      "connectorId": "/providers/Microsoft.PowerApps/apis/shared_office365",
      "displayName": "Office 365 Outlook"
    }
  }
}
```

### example: `environment-variables.json`

```json
{
  "envVariables": [
    { "name": "OrgName", "value": "Contoso" },
    { "name": "NotificationChannel", "value": "General" }
  ]
}
```

### example: `pack-solution.ps1`

```powershell
# requires: Power Platform CLI installed and logged in
pac auth create --name 'env1'
pac solution pack --zipfile ./MySolution.zip --folder ./solution-unpacked
```

### example: `import-solution.ps1`

```powershell
# import into target environment
pac auth create --name 'target'
pac solution import --path ./MySolution.zip --environment target
```

### `post-import-seed.ps1` (PowerShell using Power Platform CLI/PowerShell modules)

```powershell
# ps pseudo-code: requires Microsoft.PowerPlatform.Cds.Client module
# This is only usable from a full Dataverse environment; in DV4T use a flow-based bootstrap or manual entry.
```

---

## 12. Component Library (reusable screens, controls, Power Fx patterns)

### 12.1 Screen: HomeScreen
- Controls:
  - `galEvaluations` (Gallery)
    - Items: `Filter(new_evaluation, new_employee = LookUp(new_employeeprofile, systemuserid = User()) )`
  - `btnNewEval` (Button)
    - OnSelect: `Navigate(NewEvaluationScreen, ScreenTransition.Cover)`

### 12.2 Screen: NewEvaluationScreen
- Controls:
  - `txtTitle` (TextInput)
  - `ddEmployee` (Dropdown) Items: `Choices(new_evaluation.new_employee)`
  - `dateEval` (DatePicker)
  - `btnSave` OnSelect:
    ```PowerFx
    Patch(new_evaluation, Defaults(new_evaluation), {
      new_title: txtTitle.Text,
      new_employee: ddEmployee.Selected.Value,
      new_evaluationdate: dateEval.SelectedDate,
      new_status: { Value: "Draft" }
    });
    Notify("Saved", NotificationType.Success);
    Back();
    ```

### 12.3 Power Fx Patterns
- Lookup creation: `Patch(table, Defaults(table), { lookupField: LookUp(targetTable, primaryField = selectedValue) })`
- Form submit with validation:
  ```PowerFx
  If(IsBlank(txtTitle.Text), Notify("Title required", NotificationType.Error), SubmitForm(frmEval))
  ```

---

## 13. Flow Templates (specs)

### Flow: EvaluationCreated -> Post Teams Message
Trigger: When a row is added to `new_evaluation` (Dataverse)
Actions:
1. Get row by ID
2. Post Adaptive Card to Teams channel or send chat message to manager (Office365 Outlook/Teams)
3. Update evaluation record with `notified=true`
Connection refs: Dataverse, Office365/Teams

### Flow: Daily Reminder (Recurrence)
Trigger: Recurrence (daily at 8:00)
Actions:
1. Query `new_evaluation` where `status = Draft` and `assignedTo` is not null
2. For each row, post message to user or channel

---

## 14. Post-Import Checklist (automated and manual)
1. Import solution ZIP into Teams Power Apps (Build > Import)
2. Map connection references and reauthenticate
3. Set environment variables
4. Turn on flows; test triggers manually
5. Seed required static tables (via flow or manual data entry)
6. Rebuild canvas app as per `canvas-app-spec.md` and connect to tables
7. Run end-to-end test cases (create evaluation, trigger flow, receive message)

---

## 15. Next Steps I can do for you now
- Generate a **zip** starter-solution with the scaffold and example files (ready for you to review).
- Produce a **prompt-ready** payload tuned for Claude with a sample feature request.
- Produce a repository-ready **README.md** for the starter-solution.

Tell me which to produce first and I will generate the files immediately.

